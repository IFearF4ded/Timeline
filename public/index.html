<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Local UDP UI</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#0e0e10;color:#fff;padding:20px}
  input,button{padding:8px;margin:6px;border-radius:6px}
  .panel{background:#121214;padding:12px;border-radius:8px;max-width:900px}
  pre{background:#000; padding:10px; max-height:340px; overflow:auto}
</style>
</head>
<body>
  <h1>Local UDP Test UI</h1>
  <div class="panel">
    <div>
      <label>Host: <input id="host" value="127.0.0.1"/></label>
      <label>Port: <input id="port" type="number" value="9999"/></label>
      <label>Threads: <input id="threads" type="number" value="8"/></label>
      <label>Seconds: <input id="seconds" type="number" value="10"/></label>
    </div>
    <div>
      <label>Payload bytes: <input id="payload" type="number" value="1024"/></label>
      <label>Rate per thread (sends/sec, 0=unlimited): <input id="rate" type="number" value="0"/></label>
    </div>
    <div>
      <button id="start">Start</button>
      <button id="stop">Stop</button>
    </div>
    <h3>Logs:</h3>
    <pre id="log">idle...</pre>
  </div>

<script>
const logEl = document.getElementById('log');
function append(s){ logEl.textContent = s + "\n" + logEl.textContent; }

document.getElementById('start').onclick = async () => {
  const data = {
    host: document.getElementById('host').value.trim(),
    port: Number(document.getElementById('port').value),
    threads: Number(document.getElementById('threads').value),
    seconds: Number(document.getElementById('seconds').value),
    payload: Number(document.getElementById('payload').value),
    rate: Number(document.getElementById('rate').value),
  };
  const r = await fetch('/start', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(data) });
  const j = await r.json();
  append(JSON.stringify(j));
};

document.getElementById('stop').onclick = async () => {
  const r = await fetch('/stop', { method: 'POST' });
  const j = await r.json();
  append(JSON.stringify(j));
};

// SSE logs
const es = new EventSource('/events');
es.onmessage = function(ev) {
  append(ev.data.replace(/\\n/g,'\n'));
};
es.onerror = function() {
  append('[SSE] connection error');
};
</script>
</body>
</html>
